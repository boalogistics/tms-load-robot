import csv
import tms_login as tms
from selenium.webdriver.common.by import By 
from selenium.webdriver.support.ui import Select, WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

url = 'https://boa.3plsystemscloud.com/'
browser = tms.login(url, False)

# put FOR loop here to loop through list of load numbers
loadlist = ['156692', 
'156693', 
'156694', 
'156695', 
'156696', 
'156697', 
'156698', 
'156699', 
'156700', 
'156701', 
'156702', 
'156703', 
'156704', 
'156705', 
'156706', 
'156707', 
'156708', 
'156709', 
'156710', 
'156711', 
'156712', 
'156713', 
'156714', 
'156715', 
'156716', 
'156717', 
'156718', 
'156719', 
'156720', 
'156721', 
'156722', 
'156723', 
'156724', 
'156725', 
'156726', 
'156727', 
'156728', 
'156729', 
'156730', 
'156731', 
'156732', 
'156733', 
'156734', 
'156735', 
'156736', 
'156737', 
'156738', 
'156739', 
'156740', 
'156741', 
'156742', 
'156743', 
'156744', 
'156745', 
'156746', 
'156747', 
'156748', 
'156749', 
'156750', 
'156751', 
'156752', 
'156753', 
'156754', 
'156755', 
'156756', 
'156757', 
'156758', 
'156759', 
'156760', 
'156761', 
'156762', 
'156763', 
'156764', 
'156765', 
'156766', 
'156767', 
'156768', 
'156769', 
'156770', 
'156771', 
'156772', 
'156773', 
'156774', 
'156775', 
'156776', 
'156777', 
'156778', 
'156779', 
'156780', 
'156781', 
'156782', 
'156783', 
'156784', 
'156785', 
'156786', 
'156787', 
'156788', 
'156789', 
'156790', 
'156791', 
'156792', 
'156793', 
'156794', 
'156795', 
'156796', 
'156797', 
'156798', 
'156799', 
'156800', 
'156801', 
'156802', 
'156803', 
'156804', 
'156805', 
'156806', 
'156807', 
'156808', 
'156809', 
'156810', 
'156811', 
'156812', 
'156813', 
'156814', 
'156815', 
'156816', 
'156817', 
'156818', 
'156819', 
'156820', 
'156821', 
'156822', 
'156823', 
'156824', 
'156825', 
'156826', 
'156827', 
'156828', 
'156829', 
'156830', 
'156831', 
'156832', 
'156833', 
'156834', 
'156835', 
'156836', 
'156837', 
'156838', 
'156839', 
'156840', 
'156841', 
'156842', 
'156843', 
'156844', 
'156845', 
'156846', 
'156847', 
'156848', 
'156849', 
'156850', 
'156851', 
'156852', 
'156853', 
'156854', 
'156855', 
'156856', 
'156857', 
'156858', 
'156859', 
'156860', 
'156861', 
'156862', 
'156863', 
'156864', 
'156865', 
'156866', 
'156867', 
'156868', 
'156869', 
'156870', 
'156871', 
'156872', 
'156873', 
'156874', 
'156875', 
'156876', 
'156877', 
'156878', 
'156879', 
'156880', 
'156881', 
'156882', 
'156883', 
'156884', 
'156885', 
'156886', 
'156887', 
'156888', 
'156889', 
'156890', 
'156891', 
'156892', 
'156893', 
'156894', 
'156895', 
'156896', 
'156897', 
'156898', 
'156899', 
'156900', 
'156901', 
'156902', 
'156903', 
'156904', 
'156905', 
'156906', 
'156907', 
'156908', 
'156909', 
'156910', 
'156911', 
'156912', 
'156913', 
'156914', 
'156915', 
'156916', 
'156917', 
'156918', 
'156919', 
'156920', 
'156921', 
'156922', 
'156923', 
'156924', 
'156925', 
'156926', 
'156927', 
'156928', 
'156929', 
'156930', 
'156931', 
'156932', 
'156933', 
'156934', 
'156935', 
'156936', 
'156937', 
'156938', 
'156939', 
'156940', 
'156941', 
'156942', 
'156943', 
'156944', 
'156945', 
'156946', 
'156947', 
'156948', 
'156949', 
'156950', 
'156951', 
'156952', 
'156953', 
'156954', 
'156955', 
'156956', 
'156957', 
'156958', 
'156959', 
'156960', 
'156961', 
'156962', 
'156963', 
'156964', 
'156965', 
'156966', 
'156967', 
'156968', 
'156969', 
'156970', 
'156971', 
'156972', 
'156973', 
'156974', 
'156975', 
'156976', 
'156977', 
'156978', 
'156979', 
'156980', 
'156981', 
'156982', 
'156983', 
'156984', 
'156985', 
'156986', 
'156987', 
'156988', 
'156989', 
'156990', 
'156991', 
'156992', 
'156993', 
'156994', 
'156995', 
'156996', 
'156997', 
'156998', 
'156999', 
'157000', 
'157001', 
'157002', 
'157003', 
'157004', 
'157005', 
'157006', 
'157007', 
'157008', 
'157009', 
'157010', 
'157011', 
'157012', 
'157013', 
'157014', 
'157015', 
'157016', 
'157017', 
'157018', 
'157019', 
'157020', 
'157021', 
'157022', 
'157023', 
'157024', 
'157025', 
'157026', 
'157027', 
'157028', 
'157029', 
'157030', 
'157031', 
'157032', 
'157033', 
'157034', 
'157035', 
'157036', 
'157037', 
'157038', 
'157039', 
'157040', 
'157041', 
'157042', 
'157043', 
'157044', 
'157045', 
'157046', 
'157047', 
'157048', 
'157049', 
'157050', 
'157051', 
'157052', 
'157053', 
'157054', 
'157055', 
'157056', 
'157057', 
'157058', 
'157059', 
'157060', 
'157061', 
'157062', 
'157063', 
'157064', 
'157065', 
'157066', 
'157067', 
'157068', 
'157069', 
'157070', 
'157071', 
'157072', 
'157073', 
'157074', 
'157075', 
'157076', 
'157077', 
'157078', 
'157079', 
'157080', 
'157081', 
'157082', 
'157083', 
'157084', 
'157085', 
'157086', 
'157087', 
'157088', 
'157089', 
'157090', 
'157091', 
'157092', 
'157093', 
'157094', 
'157095', 
'157096', 
'157097', 
'157098', 
'157099', 
'157100', 
'157101', 
'157102', 
'157103', 
'157104', 
'157105', 
'157106', 
'157107', 
'157108', 
'157109', 
'157110', 
'157111', 
'157112', 
'157113', 
'157114', 
'157115', 
'157116', 
'157117', 
'157118', 
'157119', 
'157120', 
'157121', 
'157122', 
'157123', 
'157124', 
'157125', 
'157126', 
'157127', 
'157128', 
'157129', 
'157130', 
'157131', 
'157132', 
'157133', 
'157134', 
'157135', 
'157136', 
'157137', 
'157138', 
'157139', 
'157140', 
'157141', 
'157142', 
'157143', 
'157144', 
'157145', 
'157146', 
'157147', 
'157148', 
'157149', 
'157150', 
'157151', 
'157152', 
'157153', 
'157154', 
'157155', 
'157156', 
'157157', 
'157158', 
'157159', 
'157160', 
'157161', 
'157162', 
'157163', 
'157164', 
'157165', 
'157166', 
'157167', 
'157168', 
'157169', 
'157170', 
'157171', 
'157172', 
'157173', 
'157174', 
'157175', 
'157176', 
'157177', 
'157178', 
'157179', 
'157180', 
'157181', 
'157182', 
'157183', 
'157184', 
'157185', 
'157186', 
'157187', 
'157188', 
'157189', 
'157190', 
'157191', 
'157192', 
'157193', 
'157194', 
'157195', 
'157196', 
'157197', 
'157198', 
'157199', 
'157200', 
'157201', 
'157202', 
'157203', 
'157204', 
'157205', 
'157206', 
'157207', 
'157208', 
'157209', 
'157210', 
'157211', 
'157212', 
'157213', 
'157214', 
'157215', 
'157216', 
'157217', 
'157218', 
'157219', 
'157220', 
'157221', 
'157222', 
'157223', 
'157224', 
'157225', 
'157226', 
'157227', 
'157228', 
'157229', 
'157230', 
'157231', 
'157232', 
'157233', 
'157234', 
'157235', 
'157236', 
'157237', 
'157238', 
'157239', 
'157240', 
'157241', 
'157242', 
'157243', 
'157244', 
'157245', 
'157246', 
'157247', 
'157248', 
'157249', 
'157250', 
'157251', 
'157252', 
'157253', 
'157254', 
'157255', 
'157256', 
'157257', 
'157258', 
'157259', 
'157260', 
'157261', 
'157262', 
'157263', 
'157264', 
'157265', 
'157266', 
'157267', 
'157268', 
'157269', 
'157270', 
'157271', 
'157272', 
'157273', 
'157274', 
'157275', 
'157276', 
'157277', 
'157278', 
'157279', 
'157280', 
'157281', 
'157282', 
'157283', 
'157284', 
'157285', 
'157286', 
'157287', 
'157288', 
'157289', 
'157290', 
'157291', 
'157292', 
'157293', 
'157294', 
'157295', 
'157296', 
'157297', 
'157298', 
'157299', 
'157300', 
'157301', 
'157302', 
'157303', 
'157304', 
'157305', 
'157306', 
'157307', 
'157308', 
'157309', 
'157310', 
'157311', 
'157312', 
'157313', 
'157314', 
'157315', 
'157316', 
'157317', 
'157318', 
'157319', 
'157320', 
'157321', 
'157322', 
'157323', 
'157324', 
'157325', 
'157326', 
'157327', 
'157328', 
'157329', 
'157330', 
'157331', 
'157332', 
'157333', 
'157334', 
'157335', 
'157336', 
'157337', 
'157338', 
'157339', 
'157340', 
'157341', 
'157342', 
'157343', 
'157344', 
'157345', 
'157346', 
'157347', 
'157348', 
'157349', 
'157350', 
'157351', 
'157352', 
'157353', 
'157354', 
'157355', 
'157356', 
'157357', 
'157358', 
'157359', 
'157360', 
'157361', 
'157362', 
'157363', 
'157364', 
'157365', 
'157366', 
'157367', 
'157368', 
'157369', 
'157370', 
'157371', 
'157372', 
'157373', 
'157374', 
'157375', 
'157376', 
'157377', 
'157378', 
'157379', 
'157380', 
'157381', 
'157382', 
'157383', 
'157384', 
'157385', 
'157386', 
'157387', 
'157388', 
'157389', 
'157390', 
'157391', 
'157392', 
'157393', 
'157394', 
'157395', 
'157396', 
'157397', 
'157398', 
'157399', 
'157400', 
'157401', 
'157402', 
'157403', 
'157404', 
'157405', 
'157406', 
'157407', 
'157408', 
'157409', 
'157410', 
'157411', 
'157412', 
'157413', 
'157414', 
'157415', 
'157416', 
'157417', 
'157418', 
'157419', 
'157420', 
'157421', 
'157422', 
'157423', 
'157424', 
'157425', 
'157426', 
'157427', 
'157428', 
'157429', 
'157430', 
'157431', 
'157432', 
'157433', 
'157434', 
'157435', 
'157436', 
'157437', 
'157438', 
'157439', 
'157440', 
'157441', 
'157442', 
'157443', 
'157444', 
'157445', 
'157446', 
'157447', 
'157448', 
'157449', 
'157450', 
'157451', 
'157452', 
'157453', 
'157454', 
'157455', 
'157456', 
'157457', 
'157458', 
'157459', 
'157460', 
'157461', 
'157462', 
'157463', 
'157464', 
'157465', 
'157466', 
'157467', 
'157468', 
'157469', 
'157470', 
'157471', 
'157472', 
'157473', 
'157474', 
'157475', 
'157476', 
'157477', 
'157478', 
'157479', 
'157480', 
'157481', 
'157482', 
'157483', 
'157484', 
'157485', 
'157486', 
'157487', 
'157488', 
'157489', 
'157490', 
'157491', 
'157492', 
'157493', 
'157494', 
'157495', 
'157496', 
'157497', 
'157498', 
'157499', 
'157500', 
'157501', 
'157502', 
'157503', 
'157504', 
'157505', 
'157506', 
'157507', 
'157508', 
'157509', 
'157510', 
'157511', 
'157512', 
'157513', 
'157514', 
'157515', 
'157516', 
'157517', 
'157518', 
'157519', 
'157520', 
'157521', 
'157522', 
'157523', 
'157524', 
'157525', 
'157526', 
'157527', 
'157528', 
'157529', 
'157530', 
'157531', 
'157532', 
'157533', 
'157534', 
'157535', 
'157536', 
'157537', 
'157538', 
'157539', 
'157540', 
'157541', 
'157542', 
'157543', 
'157544', 
'157545', 
'157546', 
'157547', 
'157548', 
'157549', 
'157550', 
'157551', 
'157658', 
'157659', 
'157660', 
'157661', 
'157662', 
'157663', 
'157664', 
'157665', 
'157666', 
'157667', 
'157668', 
'157669', 
'157670', 
'157671', 
'157672', 
'157673', 
'157674', 
'157675', 
'157676', 
'157677', 
'157678', 
'157679', 
'157680', 
'157681', 
'157682', 
'157683', 
'157684', 
'157685', 
'157686', 
'157687', 
'157688', 
'157689', 
'157690', 
'157691', 
'157692', 
'157693', 
'157694', 
'157695', 
'157696', 
'157697', 
'157698', 
'157699', 
'157700', 
'157701', 
'157702', 
'157703', 
'157704', 
'157705', 
'157706', 
'157707', 
'157708', 
'157709', 
'157710', 
'157711', 
'157712', 
'157713', 
'157714', 
'157715', 
'157716', 
'157717', 
'157718', 
'157719', 
'157720', 
'157721', 
'157722', 
'157723', 
'157724', 
'157725', 
'157726', 
'157727', 
'157728', 
'157729', 
'157730', 
'157731', 
'157732', 
'157733', 
'157734', 
'157735', 
'157736', 
'157737', 
'157738', 
'157739', 
'157740', 
'157741', 
'157742', 
'157743', 
'157744', 
'157745', 
'157746', 
'157747', 
'157748', 
'157749', 
'157750', 
'157751', 
'157752', 
'157753', 
'157754', 
'157755', 
'157756', 
'157757', 
'157758', 
'157759', 
'157760', 
'157761', 
'157762', 
'157763', 
'157764', 
'157765', 
'157766', 
'157767', 
'157768', 
'157769', 
'157770', 
'157771', 
'157772', 
'157773', 
'157774', 
'157775', 
'157776', 
'157777', 
'157778', 
'157779', 
'157780', 
'157781',
'157782', 
'157783', 
'157784', 
'157785', 
'157786'
]

for x in loadlist:
    try:
        load_id = x
        url = 'https://boa.3plsystemscloud.com/App_BW/staff/shipment/shipmentDetail.aspx?loadid='+load_id
        browser.get(url)

        WebDriverWait(browser, timeout=120).until(EC.element_to_be_clickable((By.ID, 'ctl00_BodyContent_anchor_Editpricing')))

        table = browser.find_element_by_id('ctl00_BodyContent_tblCommodities')

        rowslist = table.find_elements_by_tag_name('tr')
        pricerow = str(len(rowslist)-1)
        marginrow = str(len(rowslist))
        # print(len(rowslist))
        # print(rowslist[len(rowslist)-1].text)
        # print(rowslist[len(rowslist)-2].text)

        cost = browser.find_element_by_xpath("//table[@id='ctl00_BodyContent_tblCommodities']/tbody/tr[" + pricerow +"]/td[@class='GridDataRight'][3]").text
        billed = browser.find_element_by_xpath("//table[@id='ctl00_BodyContent_tblCommodities']/tbody/tr[" + pricerow +"]/td[@class='GridDataRight'][2]").text
        margin_usd = browser.find_element_by_xpath("//table[@id='ctl00_BodyContent_tblCommodities']/tbody/tr[" + marginrow +"]/td[@class='GridDataRight'][3]").text
        margin_pct = browser.find_element_by_xpath("//table[@id='ctl00_BodyContent_tblCommodities']/tbody/tr[" + marginrow +"]/td[@class='GridDataRight'][2]").text
        
        print('Load: ' + load_id + ', Cost: ' + cost + ', Billed: ' + billed + ', Margin$: ' + margin_usd + ', Margin%: ' + margin_pct)
        
        with open('pricing.csv', mode='a+') as pricing:
            price_writer = csv.writer(pricing, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
            price_writer.writerow([load_id, cost, billed, margin_usd, margin_pct])
    except Exception as e:
        print(load_id + ' threw ' + repr(e))
        with open('pricing.csv', mode='a+') as pricing:
            price_writer = csv.writer(pricing, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
            price_writer.writerow([load_id, cost, billed, margin_usd, margin_pct])
          
browser.quit()

# def carrier_filter(carrier_dict):
#         for key in carrier_dict:
#             carrier_dict[key] = carrier_name.lower().find(key) < 0