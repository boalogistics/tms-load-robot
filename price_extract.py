import csv
import tms_login as tms
from selenium.webdriver.common.by import By 
from selenium.webdriver.support.ui import Select, WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

url = 'https://boa.3plsystemscloud.com/'
browser = tms.login(url, False)

# put FOR loop here to loop through list of load numbers
loadlist = ['158080', 
'158081', 
'158082', 
'158083', 
'158084', 
'158085', 
'158086', 
'158087', 
'158088', 
'158089', 
'158090', 
'158091', 
'158092', 
'158093', 
'158094', 
'158095', 
'158096', 
'158097', 
'158098', 
'158099', 
'158100', 
'158101', 
'158102', 
'158103', 
'158104', 
'158105', 
'158106', 
'158107', 
'158108', 
'158109', 
'158110', 
'158111', 
'158112', 
'158113', 
'158114', 
'158115', 
'158116', 
'158117', 
'158118', 
'158119', 
'158120', 
'158121', 
'158122', 
'158123', 
'158124', 
'158125', 
'158126', 
'158127', 
'158128', 
'158129', 
'158130', 
'158131', 
'158132', 
'158133', 
'158134', 
'158135', 
'158136', 
'158137', 
'158138', 
'158139', 
'158140', 
'158141', 
'158142', 
'158143', 
'158144', 
'158145', 
'158146', 
'158147', 
'158148', 
'158149', 
'158150', 
'158151', 
'158152', 
'158153', 
'158154', 
'158155', 
'158156', 
'158157', 
'158158', 
'158159', 
'158160', 
'158161', 
'158162', 
'158163', 
'158164', 
'158165', 
'158166', 
'158167', 
'158168', 
'158169', 
'158170', 
'158171', 
'158172', 
'158173', 
'158174', 
'158175', 
'158176', 
'158177', 
'158178', 
'158179', 
'158180', 
'158181', 
'158182', 
'158183', 
'158184', 
'158185', 
'158186', 
'158187', 
'158188', 
'158189', 
'158190', 
'158191', 
'158192', 
'158193', 
'158194', 
'158195', 
'158196', 
'158197', 
'158198', 
'158199', 
'158200', 
'158201', 
'158202', 
'158203', 
'158204', 
'158205', 
'158206', 
'158207', 
'158208', 
'158209', 
'158210', 
'158211', 
'158212', 
'158213', 
'158214', 
'158215', 
'158216', 
'158217', 
'158218', 
'158219', 
'158220', 
'158221', 
'158222', 
'158223', 
'158224', 
'158225', 
'158226', 
'158227', 
'158228', 
'158229', 
'158230', 
'158231', 
'158232', 
'158233', 
'158234', 
'158235', 
'158236', 
'158237', 
'158238', 
'158239', 
'158240', 
'158241', 
'158242', 
'158243', 
'158244', 
'158245', 
'158246', 
'158247', 
'158248', 
'158249', 
'158250', 
'158251', 
'158252', 
'158253', 
'158254', 
'158255', 
'158256', 
'158257', 
'158258', 
'158259', 
'158260', 
'158261', 
'158262', 
'158263', 
'158264', 
'158265', 
'158266', 
'158267', 
'158268', 
'158269', 
'158270', 
'158271', 
'158272', 
'158273', 
'158274', 
'158275', 
'158276', 
'158277', 
'158278', 
'158279', 
'158280', 
'158281', 
'158282', 
'158283', 
'158284', 
'158285', 
'158286', 
'158287', 
'158288', 
'158289', 
'158290', 
'158291', 
'158292', 
'158293', 
'158294', 
'158295', 
'158296', 
'158297', 
'158298', 
'158299', 
'158300', 
'158301', 
'158302', 
'158303', 
'158304', 
'158305', 
'158306', 
'158307', 
'158308', 
'158309', 
'158310', 
'158311', 
'158312', 
'158313', 
'158314', 
'158315', 
'158316', 
'158317', 
'158318', 
'158319', 
'158320', 
'158321', 
'158322', 
'158323', 
'158324', 
'158325', 
'158326', 
'158327', 
'158328', 
'158329', 
'158330', 
'158331', 
'158332', 
'158333', 
'158334', 
'158335', 
'158336', 
'158337', 
'158338', 
'158339', 
'158340', 
'158341', 
'158342', 
'158343', 
'158344', 
'158345', 
'158346', 
'158347', 
'158348', 
'158349', 
'158350', 
'158351', 
'158352', 
'158353', 
'158354', 
'158355', 
'158356', 
'158357', 
'158358', 
'158359', 
'158360', 
'158361', 
'158362', 
'158363', 
'158364', 
'158365', 
'158366', 
'158367', 
'158368', 
'158369', 
'158370', 
'158371', 
'158372', 
'158373', 
'158374', 
'158375', 
'158376', 
'158377', 
'158378', 
'158379', 
'158380', 
'158381', 
'158382', 
'158383', 
'158384', 
'158385', 
'158386', 
'158387', 
'158388', 
'158389', 
'158390', 
'158391', 
'158392', 
'158393', 
'158394', 
'158395', 
'158396', 
'158397', 
'158398', 
'158399', 
'158400', 
'158401', 
'158402', 
'158403', 
'158404', 
'158405', 
'158406', 
'158407', 
'158408', 
'158409', 
'158410', 
'158411', 
'158412', 
'158413', 
'158414', 
'158415', 
'158416', 
'158417', 
'158418', 
'158419', 
'158420', 
'158421', 
'158422', 
'158423', 
'158424', 
'158425', 
'158426', 
'158427', 
'158428', 
'158429', 
'158430', 
'158431', 
'158432', 
'158433', 
'158434', 
'158435', 
'158436', 
'158437', 
'158438', 
'158439', 
'158440', 
'158441', 
'158442', 
'158443', 
'158444', 
'158445', 
'158446', 
'158447', 
'158448', 
'158449', 
'158450', 
'158451', 
'158452', 
'158453', 
'158454', 
'158455', 
'158456', 
'158457', 
'158458', 
'158459', 
'158460', 
'158461', 
'158462', 
'158463', 
'158464', 
'158465', 
'158466', 
'158467', 
'158468', 
'158469', 
'158470', 
'158471', 
'158472', 
'158473', 
'158474', 
'158475', 
'158476', 
'158477', 
'158478', 
'158479', 
'158480', 
'158481', 
'158482', 
'158483', 
'158484', 
'158485', 
'158486', 
'158487', 
'158488', 
'158489', 
'158490', 
'158491', 
'158492', 
'158493', 
'158494', 
'158495', 
'158496', 
'158497', 
'158498', 
'158499', 
'158500', 
'158501', 
'158502', 
'158503', 
'158504', 
'158505', 
'158506', 
'158507', 
'158508', 
'158509', 
'158510', 
'158511', 
'158512', 
'158513', 
'158514', 
'158515', 
'158516', 
'158517', 
'158518', 
'158519', 
'158520', 
'158521', 
'158522', 
'158523', 
'158524', 
'158525', 
'158526', 
'158527', 
'158528', 
'158529', 
'158530', 
'158531', 
'158532', 
'158533', 
'158534', 
'158535', 
'158536', 
'158537', 
'158538', 
'158539', 
'158540', 
'158541', 
'158542', 
'158543', 
'158544', 
'158545', 
'158546', 
'158547', 
'158548', 
'158549', 
'158550', 
'158551', 
'158552', 
'158553', 
'158554', 
'158555', 
'158556', 
'158557', 
'158558', 
'158559', 
'158560', 
'158561', 
'158562', 
'158563', 
'158564', 
'158565', 
'158566', 
'158567', 
'158568', 
'158569', 
'158570', 
'158571', 
'158572', 
'158573', 
'158574', 
'158575', 
'158576', 
'158577', 
'158578', 
'158579', 
'158580', 
'158581', 
'158582', 
'158583', 
'158584', 
'158585', 
'158586', 
'158587', 
'158588', 
'158589', 
'158590', 
'158591', 
'158592', 
'158593', 
'158594', 
'158595', 
'158596', 
'158597', 
'158598', 
'158599', 
'158600', 
'158601', 
'158602', 
'158603', 
'158604', 
'158605', 
'158606', 
'158607', 
'158608', 
'158609', 
'158610', 
'158611', 
'158612', 
'158613', 
'158614', 
'158615', 
'158616', 
'158617', 
'158618', 
'158619', 
'158620', 
'158621', 
'158622', 
'158623', 
'158624', 
'158625', 
'158626', 
'158627', 
'158628', 
'158629', 
'158630', 
'158631', 
'158632', 
'158633', 
'158634', 
'158635', 
'158636', 
'158637', 
'158638', 
'158639', 
'158640', 
'158641', 
'158642', 
'158643', 
'158644', 
'158645', 
'158646', 
'158647', 
'158648', 
'158649', 
'158650', 
'158651', 
'158652', 
'158653', 
'158654', 
'158655', 
'158656', 
'158657', 
'158658', 
'158659', 
'158660', 
'158661', 
'158662', 
'158663', 
'158664', 
'158665', 
'158666', 
'158667', 
'158668', 
'158669', 
'158670', 
'158671', 
'158672', 
'158673', 
'158674', 
'158675', 
'158676', 
'158677', 
'158678', 
'158679', 
'158680', 
'158681', 
'158682', 
'158683', 
'158684', 
'158685', 
'158686', 
'158687', 
'158688', 
'158689', 
'158690', 
'158691', 
'158692', 
'158693', 
'158694', 
'158695', 
'158696', 
'158697', 
'158698', 
'158699', 
'158700', 
'158701', 
'158702', 
'158703', 
'158704', 
'158705', 
'158706', 
'158707', 
'158708', 
'158709', 
'158710', 
'158711', 
'158712', 
'158713', 
'158714', 
'158715', 
'158716', 
'158717', 
'158718', 
'158719', 
'158720', 
'158721', 
'158722', 
'158723', 
'158724', 
'158725', 
'158726', 
'158727', 
'158728', 
'158729', 
'158730', 
'158731', 
'158732', 
'158733', 
'158734', 
'158735', 
'158736', 
'158737', 
'158738', 
'158739', 
'158740', 
'158741', 
'158742', 
'158743', 
'158744', 
'158745', 
'158746', 
'158747', 
'158748', 
'158749', 
'158750', 
'158751', 
'158752', 
'158753', 
'158754', 
'158755', 
'158756', 
'158757', 
'158758', 
'158759', 
'158760', 
'158761', 
'158762', 
'158763', 
'158764', 
'158765', 
'158766', 
'158767', 
'158768', 
'158769', 
'158770', 
'158771', 
'158772', 
'158773', 
'158774', 
'158775', 
'158776', 
'158777', 
'158778', 
'158779', 
'158780', 
'158781', 
'158782', 
'158783', 
'158784', 
'158785', 
'158786'
]

for x in loadlist:
    try:
        load_id = x
        url = 'https://boa.3plsystemscloud.com/App_BW/staff/shipment/shipmentDetail.aspx?loadid='+load_id
        browser.get(url)

        WebDriverWait(browser, timeout=120).until(EC.element_to_be_clickable((By.ID, 'ctl00_BodyContent_anchor_Editpricing')))

        table = browser.find_element_by_id('ctl00_BodyContent_tblCommodities')

        rowslist = table.find_elements_by_tag_name('tr')
        pricerow = str(len(rowslist)-1)
        marginrow = str(len(rowslist))
        # print(len(rowslist))
        # print(rowslist[len(rowslist)-1].text)
        # print(rowslist[len(rowslist)-2].text)

        cost = browser.find_element_by_xpath("//table[@id='ctl00_BodyContent_tblCommodities']/tbody/tr[" + pricerow +"]/td[@class='GridDataRight'][3]").text
        billed = browser.find_element_by_xpath("//table[@id='ctl00_BodyContent_tblCommodities']/tbody/tr[" + pricerow +"]/td[@class='GridDataRight'][2]").text
        margin_usd = browser.find_element_by_xpath("//table[@id='ctl00_BodyContent_tblCommodities']/tbody/tr[" + marginrow +"]/td[@class='GridDataRight'][3]").text
        margin_pct = browser.find_element_by_xpath("//table[@id='ctl00_BodyContent_tblCommodities']/tbody/tr[" + marginrow +"]/td[@class='GridDataRight'][2]").text
        
        print('Load: ' + load_id + ', Cost: ' + cost + ', Billed: ' + billed + ', Margin$: ' + margin_usd + ', Margin%: ' + margin_pct)
        
        with open('pricing.csv', mode='a+') as pricing:
            price_writer = csv.writer(pricing, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
            price_writer.writerow([load_id, cost, billed, margin_usd, margin_pct])
    except Exception as e:
        print(load_id + ' threw ' + repr(e))
        with open('pricing.csv', mode='a+') as pricing:
            price_writer = csv.writer(pricing, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
            price_writer.writerow([load_id, cost, billed, margin_usd, margin_pct])
          
browser.quit()

# def carrier_filter(carrier_dict):
#         for key in carrier_dict:
#             carrier_dict[key] = carrier_name.lower().find(key) < 0